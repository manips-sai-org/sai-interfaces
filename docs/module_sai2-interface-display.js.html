<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: module/sai2-interface-display.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: module/sai2-interface-display.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/** 
 * Defines a custom HTML element to periodically query a Redis key at a
 * certain frequency and displays it as a label. 
 * &lt;br>
 * &lt;pre>
 * Element Tag: &amp;lt;sai2-interface-trajectory-display&amp;gt;
 * HTML attributes:
 *    key: string - Redis key to query
 *    refreshRate: number - How often, in seconds, to update
 *    decimalPlaces: number - How many decimal places to show
 * &lt;/pre>
 * @module ./module/sai2-interface-display 
 */

import { get_redis_val } from '../redis.js';


const template = document.createElement('template');
template.innerHTML = `
  &lt;style>
    .sai2-interface-display-top {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      width: 100%;
    }

    .sai2-interface-display-top div {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      width: 100%;
      align-items: center;
    }

    .sai2-interface-display-top div label {
      flex: 1;
      text-align: left;
    }

    .sai2-interface-display-top div input[type=number] {
      flex: 1;
      width: inherit;
    }

  &lt;/style>
  &lt;div class="sai2-interface-display-top">
  &lt;/div>
`;

customElements.define('sai2-interface-display', class extends HTMLElement {
  constructor() {
    super();
    this.template = template;
    this.connectedCallback = this.connectedCallback.bind(this);
    this.update_value = this.update_value.bind(this);
  }

  /**
  * Executed when it is time to update the displayed value.
   */
  update_value() {
    get_redis_val(this.key).then(value => {
      for (let i = 0; i &lt; this.value_inputs.length; i++) {
        let current_value = (Array.isArray(value)) ? value[i] : value;
        this.value_inputs[i].value = current_value.toFixed(this.decimalPlaces);
      }
    });
  }

  connectedCallback() {
    let template_node = this.template.content.cloneNode(true);
    this.key = this.getAttribute('key');
    this.refreshRate = this.getAttribute('refreshRate');
    this.decimalPlaces = this.getAttribute('decimalPlaces');

    // if we can parse as a JSON array, attempt to do so
    let raw_disp = this.getAttribute('display');
    try {
      this.display = JSON.parse(raw_disp);
    } catch (e) {
      this.display = raw_disp;
    }

    this.value_inputs = [];

    // create sliders
    let container = template_node.querySelector('div');
    get_redis_val(this.key).then(value => {
      // determine iteration bounds: 1 if scalar key, array size if vector
      let len = (Array.isArray(value)) ? value.length : 1;
      
      for (let i = 0; i &lt; len; i++) {
        /** 
         * The following js should be equivalent of this:
         * &lt;div>
         * 	 &lt;label>item name&lt;/label>
         *   &lt;label>item value&lt;/label>
         * &lt;div>
         */

        let key_value_div = document.createElement('div');
        let key_label = document.createElement('label');
        let value_input = document.createElement('input');

        // assign key name based on display attribute
        if (Array.isArray(value)) {
          if (Array.isArray(this.display)) {
            key_label.innerHTML = this.display[i];
          } else {
            key_label.innerHTML = (this.display || this.key) + "[" + i + "]";
          }
        } else {
            key_label.innerHTML = this.display || this.key;
        }

        // set display value
        let current_value = (Array.isArray(value)) ? value[i] : value;
        value_input.type = 'number';
        value_input.className = 'value';
        value_input.disabled = true;
        value_input.value = current_value.toFixed(this.decimalPlaces);

        // add them all together
        key_value_div.append(key_label);
        key_value_div.append(value_input);
        container.append(key_value_div);

        // add to value_labels for later update
        this.value_inputs.push(value_input);
      }

      // TODO: find a way to call clearInterval when this element is not in view
      this.poll_handle = setInterval(this.update_value, this.refreshRate * 1000);
    });

    // append to document
    this.appendChild(template_node);
  }
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-._const.html">./const</a></li><li><a href="module-._module_sai2-interface-display.html">./module/sai2-interface-display</a></li><li><a href="module-._module_sai2-interface-enum.html">./module/sai2-interface-enum</a></li><li><a href="module-._module_sai2-interface-logger.html">./module/sai2-interface-logger</a></li><li><a href="module-._module_sai2-interface-plot.html">./module/sai2-interface-plot</a></li><li><a href="module-._module_sai2-interface-select.html">./module/sai2-interface-select</a></li><li><a href="module-._module_sai2-interface-slider.html">./module/sai2-interface-slider</a></li><li><a href="module-._module_sai2-interface-toggle.html">./module/sai2-interface-toggle</a></li><li><a href="module-._module_sai2-interface-trajectory-slider.html">./module/sai2-interface-trajectory-slider</a></li><li><a href="module-._redis.html">./redis</a></li><li><a href="module-._resize.html">./resize</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Jul 24 2019 21:46:59 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
